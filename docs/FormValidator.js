!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FormValidator=t():e.FormValidator=t()}(this,(()=>(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{FormValidator:()=>M});const i="field:validated",s="form:validated",a="count:updated",r="submit:state-changed",l="form:reset";class n{constructor(e){this.fields=new Map,this.eventManager=e}initializeField(e,t,i,s){const a=s?s(t):this.checkFieldInHiddenArea(e),r=!a&&(t.hasAttribute("required")||t.dataset.validate&&t.dataset.validate.split(",").map((e=>e.trim())).includes("required")),l=t.value||"",n=a||!r||!!l.trim(),o={value:l,isValid:n,errors:[],isDirty:!1,isTouched:!1,...i};this.fields.set(e,o)}updateField(e,t){const i=this.fields.get(e);if(i){const s={...i,...t};this.fields.set(e,s)}}getField(e){return this.fields.get(e)}getAllStates(){const e={};for(const[t,i]of this.fields)e[t]={...i};return e}getValidFieldCount(){let e=0;for(const t of this.fields.values())t.isValid&&e++;return e}getTotalFieldCount(){return this.fields.size}get isValid(){for(const[e,t]of this.fields)if(!this.checkFieldInHiddenArea(e)&&!t.isValid)return!1;return!0}get isDirty(){for(const e of this.fields.values())if(e.isDirty)return!0;return!1}reset(){for(const[e,t]of this.fields)this.fields.set(e,{...t,value:"",isValid:!0,errors:[],isDirty:!1,isTouched:!1})}removeField(e){this.fields.delete(e)}clear(){this.fields.clear()}isFieldInHiddenArea(e){return this.checkFieldInHiddenArea(e)}checkFieldInHiddenArea(e){const t=document.querySelector(`[name='${e}'], [id='${e}']`);if(!t)return!1;if(t.hasAttribute("data-validate-hidden"))return!0;let i=t.parentElement;for(;i;){if(i.hasAttribute("data-validate-hidden"))return!0;i=i.parentElement}return!1}reevaluateFieldRequiredState(e,t){const i=document.querySelector(`[name='${e}'], [id='${e}']`);if(!i||!(i instanceof HTMLInputElement||i instanceof HTMLSelectElement||i instanceof HTMLTextAreaElement)){const i=document.querySelector(`[id='${e}']`);if(i&&(i.hasAttribute("data-check_validate")||i.hasAttribute("data-radio_validate")||i.hasAttribute("data-select_validate"))){const s=this.fields.get(e);if(!s)return;const a=t?t(e):this.checkFieldInHiddenArea(e);let r=!1;const l=i.getAttribute("data-check_validate"),n=i.getAttribute("data-radio_validate"),o=i.getAttribute("data-select_validate");(l&&l.includes("required")||n&&n.includes("required")||o&&o.includes("required"))&&(r=!0),r=!a&&r;const d={isValid:a||!r,errors:a||!r?[]:s.errors,isTouched:!1};return this.fields.set(e,{...s,...d}),void("undefined"!=typeof console&&console.log&&console.log(`[FieldStateManager] Reevaluated group ${e}: isInHiddenArea=${a}, isRequired=${r}, resetTouched=true`))}return}const s=this.fields.get(e);if(!s)return;const a=t?t(e):this.checkFieldInHiddenArea(e),r=!a&&(i.hasAttribute("required")||i.dataset.validate&&i.dataset.validate.split(",").map((e=>e.trim())).includes("required"));let l,n=!1;if(a)l=!0,n=!0;else if(r){l=!!(i.value||"").trim()}else l=!0;const o={isValid:l,errors:l?[]:s.errors};n&&(o.isTouched=!1),this.fields.set(e,{...s,...o}),"undefined"!=typeof console&&console.log&&console.log(`[FieldStateManager] Reevaluated field ${e}: isInHiddenArea=${a}, isRequired=${r}, isValid=${l}, resetTouched=${n}`)}reevaluateAllFieldsRequiredState(e){for(const t of this.fields.keys())this.reevaluateFieldRequiredState(t,e)}getRequiredFieldIds(e){const t=[],i=[];for(const[s,a]of this.fields){if(e?e(s):this.checkFieldInHiddenArea(s)){i.push(s);continue}const a=document.querySelector(`[name='${s}'], [id='${s}']`);if((a instanceof HTMLInputElement||a instanceof HTMLSelectElement||a instanceof HTMLTextAreaElement)&&(a.hasAttribute("required")||a.dataset.validate&&a.dataset.validate.split(",").map((e=>e.trim())).includes("required")))t.push(s);else if(a instanceof HTMLElement){const e=a.getAttribute("data-check_validate"),i=a.getAttribute("data-radio_validate"),r=a.getAttribute("data-select_validate");if(e&&e.includes("required")){t.push(s);continue}if(i&&i.includes("required")){t.push(s);continue}if(r&&r.includes("required")){t.push(s);continue}}}return"undefined"!=typeof console&&console.log&&(console.log("[FieldStateManager] Required fields:",t),console.log("[FieldStateManager] Excluded fields:",i)),t}getValidRequiredFieldCount(e){let t=0;for(const i of this.getRequiredFieldIds(e)){const e=this.fields.get(i);e&&e.isValid&&t++}return t}getTotalRequiredFieldCount(e){return this.getRequiredFieldIds(e).length}}class o{constructor(e){this.errorElements=new Map,this.options=e}showFieldError(e,t,i){if(!this.options.showOnValidation)return;this.clearField(e);let s=this.findTemplateErrorElement(i);if(s)s.textContent=t,s.style.display="block";else{s=this.createErrorElement(t),s.id=`${e}-error`,s.setAttribute("role","alert"),s.setAttribute("aria-live","polite");const a=i.parentElement;a&&a.insertBefore(s,i.nextSibling)}s.id||(s.id=`${e}-error`);const a=i.getAttribute("aria-describedby");a?i.setAttribute("aria-describedby",`${a} ${s.id}`):i.setAttribute("aria-describedby",s.id),this.errorElements.set(e,s),i.classList.add("error","invalid"),i.setAttribute("aria-invalid","true")}clearField(e){const t=this.errorElements.get(e);t&&(t.hasAttribute("data-text")&&"error"===t.getAttribute("data-text")?(t.textContent="",t.style.display="none"):t.parentElement&&t.parentElement.removeChild(t),this.errorElements.delete(e));const i=document.querySelector(`[name="${e}"], [id="${e}"]`);if(i){const s=this.findTemplateErrorElement(i);s&&s!==t&&(s.textContent="",s.style.display="none");const a=i.getAttribute("aria-describedby");if(a){const t=a.split(" ").filter((t=>t!==`${e}-error`)).join(" ");t?i.setAttribute("aria-describedby",t):i.removeAttribute("aria-describedby")}i.classList.remove("error","invalid"),i.setAttribute("aria-invalid","false")}}clearAll(){for(const e of this.errorElements.keys())this.clearField(e)}findTemplateErrorElement(e){const t=e.parentElement;if(t){const e=t.querySelector('[data-text="error"]');if(e)return e}if(e.hasAttribute("data-check_validate")||e.hasAttribute("data-radio_validate")||e.hasAttribute("data-select_validate")){let t=e.nextElementSibling;for(;t;){if(t.hasAttribute("data-text")&&"error"===t.getAttribute("data-text"))return t;t=t.nextElementSibling}}return null}createErrorElement(e){const t=document.createElement("div");return t.className="error-message",t.textContent=e,t}hasError(e){return this.errorElements.has(e)}getErrorCount(){return this.errorElements.size}}class d{constructor(){this.next=null}setNext(e){return this.next=e,e}async handleNext(e,t){if(this.next){return await this.next.validate(e,t)}return{isValid:!0,errors:[]}}combineResults(e,t){return{isValid:e.isValid&&t.isValid,errors:[...e.errors,...t.errors]}}isEmpty(e){return null===e||(void 0===e||("string"==typeof e?""===e.trim():Array.isArray(e)?0===e.length:"object"==typeof e&&0===Object.keys(e).length))}convertToString(e,t,i,s){if("string"==typeof e)return{success:!0,value:e};if("number"==typeof e)return{success:!0,value:String(e)};{const a=this.createErrorMessage(t,i,s);return{success:!1,result:this.createFailureResult([this.createError(t,a,e)])}}}createErrorMessage(e,t,i){return i?.message?i.message:t}createError(e,t,i){return{rule:e,message:t,value:i}}createSuccessResult(){return{isValid:!0,errors:[]}}createFailureResult(e){return{isValid:!1,errors:e}}}class u extends d{constructor(){super(...arguments),this.defaultMessages={default:"„Åì„ÅÆÈ†ÖÁõÆ„ÅØÂÖ•ÂäõÂøÖÈ†à„Åß„Åô„ÄÇ",name:"„ÅäÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",furiganaHira:"„Åµ„Çä„Åå„Å™„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",furiganaKana:"„Éï„É™„Ç¨„Éä„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",postalCode:"ÈÉµ‰æøÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",postal:"‰ΩèÊâÄ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",tel:"ÈõªË©±Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",email:"„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",emailConf:"Á¢∫Ë™çÁî®„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",password:"„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",text:"„ÅäÂïè„ÅÑÂêà„Çè„ÅõÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",checkbox:"„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",radiobox:"„É©„Ç∏„Ç™„Éú„Çø„É≥„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",agree:"ÂÄã‰∫∫ÊÉÖÂ†±‰øùË≠∑ÊñπÈáù„ÅÆÂêåÊÑè„Å´„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂÖ•„Çå„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",select:"ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"}}async validate(e,t){if(this.isEmpty(e)){const i=this.determineErrorMessage(t);return this.createFailureResult([this.createError("required",i,e)])}return await this.handleNext(e,t)}determineErrorMessage(e){if(e?.message)return e.message;if(e?.customMessageKey&&e?.customMessages?.[e.customMessageKey])return e.customMessages[e.customMessageKey];if(e?.fieldType){const t=e.fieldType;if(t in this.defaultMessages)return this.defaultMessages[t]}if(e?.validationTypes){const t=e.validationTypes;if(t.includes("name"))return this.defaultMessages.name;if(t.includes("furigana")){if(t.includes("hiragana"))return this.defaultMessages.furiganaHira;if(t.includes("katakana"))return this.defaultMessages.furiganaKana}if(t.includes("postal-code"))return this.defaultMessages.postalCode;if(t.includes("postal"))return this.defaultMessages.postal;if(t.includes("tel"))return this.defaultMessages.tel;if(t.includes("email-conf"))return this.defaultMessages.emailConf;if(t.includes("email"))return this.defaultMessages.email;if(t.includes("password"))return this.defaultMessages.password;if(t.includes("text"))return this.defaultMessages.text;if(t.includes("agree"))return this.defaultMessages.agree}return"checkbox"===e?.elementType?this.defaultMessages.checkbox:"radio"===e?.elementType?this.defaultMessages.radiobox:"select"===e?.elementType?this.defaultMessages.select:this.defaultMessages.default}}class c extends d{constructor(){super(...arguments),this.emailPattern=/^([a-zA-Z0-9])+([a-zA-Z0-9\._-])*@([a-zA-Z0-9_-])+([a-zA-Z0-9\._-]+)+$/,this.defaultMessage="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ"}async validate(e,t){if(this.isEmpty(e))return await this.handleNext(e,t);const i=this.convertToString(e,"email",this.defaultMessage,t);if(!i.success)return i.result;const s=i.value;if(!this.emailPattern.test(s)){const i=this.createErrorMessage("email",this.defaultMessage,t);return this.createFailureResult([this.createError("email",i,e)])}if(t?.checkConfirmation){const i=t.confirmationValue;if(i&&s!==i){const i=t.mismatchMessage||"„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì„ÄÇ";return this.createFailureResult([this.createError("email-mismatch",i,e)])}}return await this.handleNext(s,t)}}class h extends d{constructor(){super(...arguments),this.defaultMessage="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì„ÄÇ"}async validate(e,t){if(this.isEmpty(e))return await this.handleNext(e,t);const i=this.convertToString(e,"email-conf",this.defaultMessage,t);if(!i.success)return i.result;const s=i.value,a=t?.originalEmail;if(a){if(s!==a){const i=this.createErrorMessage("email-conf",this.defaultMessage,t);return this.createFailureResult([this.createError("email-conf",i,e)])}}else{const i=document.querySelector('input[data-validate*="email"]:not([data-validate*="email-conf"])');if(i){if(s!==i.value){const i=this.createErrorMessage("email-conf",this.defaultMessage,t);return this.createFailureResult([this.createError("email-conf",i,e)])}}}return await this.handleNext(s,t)}}class f extends d{constructor(){super(...arguments),this.patterns={telWithHyphens:/^0(((\d{1}-\d{4}|\d{2}-\d{3,4}|\d{3}-\d{2,3}|\d{4}-\d{1})-\d{4})|\d{3}-\d{3}-\d{3})$/,telWithoutHyphens:/^0\d{9,10}$/,halfWidth:/^[0-9\-]+$/},this.defaultMessages={default:"ÈõªË©±Áï™Âè∑„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",withHyphens:"ÈõªË©±Áï™Âè∑„ÅØ„Éè„Ç§„Éï„É≥‰ªò„Åç„ÅÆÂΩ¢Âºè„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",withoutHyphens:"ÈõªË©±Áï™Âè∑„ÅØ„Éè„Ç§„Éï„É≥„Å™„Åó„ÅÆÂΩ¢Âºè„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",halfWidth:"ÂçäËßíÊï∞Â≠ó„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"}}async validate(e,t){if(this.isEmpty(e))return await this.handleNext(e,t);const i=this.convertToString(e,"tel",this.defaultMessages.default,t);if(!i.success)return i.result;const s=i.value,a=this.normalizeNumber(s);if(!this.patterns.halfWidth.test(a)){const i=this.createErrorMessage("tel-halfwidth",this.defaultMessages.halfWidth,t);return this.createFailureResult([this.createError("tel-halfwidth",i,e)])}const r=t?.allowHyphens??null;let l=!1,n=this.defaultMessages.default;if(!0===r?(l=this.patterns.telWithHyphens.test(a),n=this.defaultMessages.withHyphens):!1===r?(l=this.patterns.telWithoutHyphens.test(a),n=this.defaultMessages.withoutHyphens):l=this.patterns.telWithHyphens.test(a)||this.patterns.telWithoutHyphens.test(a),!l){const i=this.createErrorMessage("tel",n,t);return this.createFailureResult([this.createError("tel",i,e)])}return await this.handleNext(a,t)}normalizeNumber(e){return e.replace(/[Ôºê-Ôºô]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/[„ÉºÔºç]/g,"-")}}class g extends d{constructor(){super(...arguments),this.patterns={postalCodeWithHyphens:/^\d{3}-\d{4}$/,postalCodeWithoutHyphens:/^\d{7}$/,halfWidth:/^[0-9\-]+$/},this.defaultMessages={default:"ÈÉµ‰æøÁï™Âè∑„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",withHyphens:"ÈÉµ‰æøÁï™Âè∑„ÅØ„Éè„Ç§„Éï„É≥‰ªò„Åç„ÅÆÂΩ¢Âºè„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",withoutHyphens:"ÈÉµ‰æøÁï™Âè∑„ÅØ„Éè„Ç§„Éï„É≥„Å™„Åó„ÅÆÂΩ¢Âºè„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",halfWidth:"ÂçäËßíÊï∞Â≠ó„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"}}async validate(e,t){if(this.isEmpty(e))return await this.handleNext(e,t);const i=this.convertToString(e,"postal-code",this.defaultMessages.default,t);if(!i.success)return i.result;const s=i.value,a=this.normalizeNumber(s);if(!this.patterns.halfWidth.test(a)){const i=this.createErrorMessage("postal-code-halfwidth",this.defaultMessages.halfWidth,t);return this.createFailureResult([this.createError("postal-code-halfwidth",i,e)])}const r=t?.allowHyphens??null;let l=!1,n=this.defaultMessages.default;if(!0===r?(l=this.patterns.postalCodeWithHyphens.test(a),n=this.defaultMessages.withHyphens):!1===r?(l=this.patterns.postalCodeWithoutHyphens.test(a),n=this.defaultMessages.withoutHyphens):l=this.patterns.postalCodeWithHyphens.test(a)||this.patterns.postalCodeWithoutHyphens.test(a),!l){const i=this.createErrorMessage("postal-code",n,t);return this.createFailureResult([this.createError("postal-code",i,e)])}return t?.usePostalCodeJS&&t?.onValidPostalCode&&t.onValidPostalCode(a),await this.handleNext(a,t)}normalizeNumber(e){return e.replace(/[Ôºê-Ôºô]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/[„ÉºÔºç]/g,"-")}}class m extends d{constructor(){super(...arguments),this.patterns={number:/^[0-9Ôºê-Ôºô]+$/,hiragana:/^[„ÅÅ-„Çì„Éº„ÄÄ ]+$/,katakana:/^[„Ç°-„É∂„Éº„ÄÄ ]+$/,halfWidth:/^[0-9]+$/,password:/^(?=.*?[a-z])(?=.*?\d)[a-z\d]{8,16}$/i},this.defaultMessages={number:"Êï∞Â≠ó„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",hiragana:"ÂÖ®Ëßí„Å≤„Çâ„Åå„Å™„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",katakana:"ÂÖ®Ëßí„Ç´„Çø„Ç´„Éä„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",halfWidth:"ÂçäËßíÊï∞Â≠ó„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",password:"ÂçäËßíËã±Êï∞Â≠ó„Çí„Åù„Çå„Åû„ÇåÂê´„ÇÄ8ÊñáÂ≠ó‰ª•‰∏ä16ÊñáÂ≠ó‰ª•‰∏ã„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"}}async validate(e,t){if(this.isEmpty(e))return await this.handleNext(e,t);const i=this.convertToString(e,"text","ÊñáÂ≠óÂàó„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",t);if(!i.success)return i.result;const s=i.value,a=t?.textType||t?.validationType;if(!a)return await this.handleNext(s,t);switch(a){case"number":if(t?.validationTypes&&t.validationTypes.includes("halfWidth")){const t=this.normalizeNumber(s);if(!this.patterns.halfWidth.test(t)){const t=this.defaultMessages.halfWidth;return this.createFailureResult([this.createError("halfwidth",t,e)])}if(!this.patterns.number.test(t)){const t=this.defaultMessages.number;return this.createFailureResult([this.createError("number",t,e)])}}else if(!this.patterns.number.test(s)){const t=this.defaultMessages.number;return this.createFailureResult([this.createError("number",t,e)])}break;case"halfWidth":if(!this.patterns.halfWidth.test(s)){const i=this.createErrorMessage("halfwidth",this.defaultMessages.halfWidth,t);return this.createFailureResult([this.createError("halfwidth",i,e)])}break;case"hiragana":if(!this.patterns.hiragana.test(s)){const i=this.createErrorMessage("hiragana",this.defaultMessages.hiragana,t);return this.createFailureResult([this.createError("hiragana",i,e)])}break;case"katakana":if(!this.patterns.katakana.test(s)){const i=this.createErrorMessage("katakana",this.defaultMessages.katakana,t);return this.createFailureResult([this.createError("katakana",i,e)])}break;case"password":if(!this.patterns.password.test(s)){const i=this.createErrorMessage("password",this.defaultMessages.password,t);return this.createFailureResult([this.createError("password",i,e)])}}return await this.handleNext(s,t)}normalizeNumber(e){return e.replace(/[Ôºê-Ôºô]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/[„ÉºÔºç]/g,"-")}}class p extends d{constructor(e,t="„Ç´„Çπ„Çø„É†„Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç®„É©„Éº"){super(),this.customValidationFunction=e,this.customErrorMessage=t}async validate(e,t){try{if(!await this.customValidationFunction(e,t)){const i=this.createErrorMessage("custom",this.customErrorMessage,t);return this.createFailureResult([this.createError("custom",i,e)])}return await this.handleNext(e,t)}catch(i){const s=t?.message||`„Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç®„É©„Éº: ${i}`;return this.createFailureResult([this.createError("custom-error",s,e)])}}}class v{constructor(){this.validators=new Map,this.validatorFactories=new Map,this.registerDefaultValidators()}registerDefaultValidators(){this.registerValidatorFactory("required",(()=>new u)),this.registerValidatorFactory("email",(()=>new c)),this.registerValidatorFactory("email-conf",(()=>new h)),this.registerValidatorFactory("tel",(()=>new f)),this.registerValidatorFactory("postal-code",(()=>new g)),this.registerValidatorFactory("number",(()=>new m)),this.registerValidatorFactory("hiragana",(()=>new m)),this.registerValidatorFactory("katakana",(()=>new m)),this.registerValidatorFactory("password",(()=>new m)),this.registerValidatorFactory("halfWidth",(()=>new m))}registerValidatorFactory(e,t){this.validatorFactories.set(e,t)}registerCustomValidator(e,t,i){this.registerValidatorFactory(e,(()=>new p(t,i)))}buildValidatorChain(e,t){if(0===e.length)return null;const i=[];for(const s of e){if(s.startsWith("emesse")){t&&(t.customMessageKey=s);continue}const e=this.validatorFactories.get(s);if(e){const t=e();i.push(t)}}if(0===i.length)return null;for(let e=0;e<i.length-1;e++)i[e].setNext(i[e+1]);return i[0]}async validate(e,t,i){let s="string"==typeof t?t.split(",").map((e=>e.trim())):[...t],a=e;if(s.includes("replace")&&"string"==typeof e){let t=e.replace(/[Ôºê-Ôºô]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/[„ÉºÔºç‚Äî‚Äï]/g,"-");e=t,s=s.filter((e=>"replace"!==e))}const r={...i,validationTypes:s};if(i?.validationOptions&&(s.includes("tel")&&i.validationOptions.tel&&void 0!==i.validationOptions.tel.allowHyphens&&(r.allowHyphens=i.validationOptions.tel.allowHyphens),s.includes("postal-code")&&i.validationOptions.postalCode&&void 0!==i.validationOptions.postalCode.allowHyphens&&(r.allowHyphens=i.validationOptions.postalCode.allowHyphens)),s.includes("number")||s.includes("hiragana")||s.includes("katakana")||s.includes("password")||s.includes("halfWidth")){const e=s.find((e=>["number","hiragana","katakana","password","halfWidth"].includes(e)));e&&(r.textType=e)}const l=this.buildValidatorChain(s,r);if(!l)return{isValid:!0,errors:[]};try{return await l.validate(a,r)}catch(t){return{isValid:!1,errors:[{rule:"validation-error",message:`„Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç®„É©„Éº: ${t}`,value:e}]}}}getRulesFromElement(e){const t=[];return e.dataset.validate&&t.push(...e.dataset.validate.split(",").map((e=>e.trim()))),e instanceof HTMLInputElement&&e.required&&!t.includes("required")&&t.push("required"),t}getElementValue(e){return e instanceof HTMLInputElement?"checkbox"===e.type?e.checked:"radio"===e.type?e.checked?e.value:"":e.value:e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement?e.value:""}async validateElement(e,t){const i=this.getRulesFromElement(e);let s=this.getElementValue(e);if(i.includes("replace")&&"string"==typeof s){let t=s.replace(/[Ôºê-Ôºô]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/[„ÉºÔºç‚Äî‚Äï]/g,"-");s=t,(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&(e.value=t)}const a={...t,elementType:e.tagName.toLowerCase()};return e instanceof HTMLInputElement&&(a.elementType=e.type),this.validate(s,i,a)}}class y{constructor(e){this.validator=new v,this.options=e}async validateField(e,t,i={},s){return await this.validator.validateElement(e,{customMessages:i,validationOptions:s})}async validateInputField(e,t,i,s){const a=e.type;switch(a){case"email":t&&!this.isValidEmail(t)&&i.push({rule:"email",message:s.email||"ÊúâÂäπ„Å™„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",value:t});break;case"url":t&&!this.isValidUrl(t)&&i.push({rule:"url",message:s.url||"ÊúâÂäπ„Å™URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",value:t});break;case"tel":t&&!this.isValidPhone(t)&&i.push({rule:"tel",message:s.tel||"ÊúâÂäπ„Å™ÈõªË©±Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",value:t});break;case"number":t&&!this.isValidNumber(t)&&i.push({rule:"number",message:s.number||"ÊúâÂäπ„Å™Êï∞ÂÄ§„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",value:t})}if(e.minLength>0&&t.length<e.minLength&&i.push({rule:"minlength",message:s.minlength||`${e.minLength}ÊñáÂ≠ó‰ª•‰∏ä„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ`,value:t}),e.maxLength>0&&t.length>e.maxLength&&i.push({rule:"maxlength",message:s.maxlength||`${e.maxLength}ÊñáÂ≠ó‰ª•‰∏ã„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ`,value:t}),"number"===a&&t){const a=parseFloat(t);isNaN(a)||(e.min&&a<parseFloat(e.min)&&i.push({rule:"min",message:s.min||`${e.min}‰ª•‰∏ä„ÅÆÂÄ§„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ`,value:t}),e.max&&a>parseFloat(e.max)&&i.push({rule:"max",message:s.max||`${e.max}‰ª•‰∏ã„ÅÆÂÄ§„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ`,value:t}))}if(e.pattern&&t){new RegExp(e.pattern).test(t)||i.push({rule:"pattern",message:s.pattern||"ÂÖ•ÂäõÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì",value:t})}}validateSelectField(e,t,i,s){}validateTextareaField(e,t,i,s){e.minLength>0&&t.length<e.minLength&&i.push({rule:"minlength",message:s.minlength||`${e.minLength}ÊñáÂ≠ó‰ª•‰∏ä„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ`,value:t}),e.maxLength>0&&t.length>e.maxLength&&i.push({rule:"maxlength",message:s.maxlength||`${e.maxLength}ÊñáÂ≠ó‰ª•‰∏ã„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ`,value:t})}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidUrl(e){try{return new URL(e),!0}catch{return!1}}isValidPhone(e){return/^[\d\-\(\)\+\s]+$/.test(e)&&e.replace(/\D/g,"").length>=10}isValidNumber(e){return!isNaN(parseFloat(e))&&isFinite(parseFloat(e))}}class b{initialize(e){this.form=e,this.setupAriaLiveRegion(),this.enhanceFormAccessibility()}setupAriaLiveRegion(){if(!this.form)return;let e=this.form.querySelector("[aria-live]");e||(e=document.createElement("div"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",e.style.cssText="\n                position: absolute;\n                width: 1px;\n                height: 1px;\n                padding: 0;\n                margin: -1px;\n                overflow: hidden;\n                clip: rect(0, 0, 0, 0);\n                white-space: nowrap;\n                border: 0;\n            ",this.form.appendChild(e)),this.ariaLiveRegion=e}enhanceFormAccessibility(){if(!this.form)return;this.form.hasAttribute("role")||this.form.setAttribute("role","form");this.form.querySelectorAll("[required]").forEach((e=>{e.hasAttribute("aria-required")||e.setAttribute("aria-required","true")})),this.enhanceLabeling(),this.enhanceFieldsets()}enhanceLabeling(){if(!this.form)return;this.form.querySelectorAll("input, select, textarea").forEach((e=>{if(e instanceof HTMLElement){const t=e.id,i=e.name;!t&&i&&(e.id=`field-${i}`);let s=this.form.querySelector(`label[for="${e.id}"]`);if(!s&&i&&(s=this.form.querySelector(`label[for="${i}"]`),s&&s.setAttribute("for",e.id)),!s){const t=e.closest("label");t&&(s=t)}s&&!e.hasAttribute("aria-labelledby")&&(s.id||(s.id=`label-${e.id}`),e.setAttribute("aria-labelledby",s.id))}}))}enhanceFieldsets(){if(!this.form)return;this.form.querySelectorAll("fieldset").forEach((e=>{const t=e.querySelector("legend");t&&!e.hasAttribute("aria-labelledby")&&(t.id||(t.id=`legend-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),e.setAttribute("aria-labelledby",t.id))}))}announceStatus(e){this.ariaLiveRegion&&(this.ariaLiveRegion.textContent=e,setTimeout((()=>{this.ariaLiveRegion&&(this.ariaLiveRegion.textContent="")}),1e3))}announceError(e){this.announceStatus(`„Ç®„É©„Éº: ${e}`)}announceSuccess(e){this.announceStatus(`ÊàêÂäü: ${e}`)}focusField(e){if(!this.form)return;const t=this.form.querySelector(`#${e}, [name="${e}"]`);t&&"function"==typeof t.focus&&t.focus()}focusFirstError(){if(!this.form)return;const e=this.form.querySelector('[aria-invalid="true"], .error');e&&"function"==typeof e.focus&&e.focus()}cleanup(){this.ariaLiveRegion&&this.ariaLiveRegion.parentElement&&this.ariaLiveRegion.parentElement.removeChild(this.ariaLiveRegion),this.ariaLiveRegion=void 0,this.form=void 0}enhanceKeyboardNavigation(){if(!this.form)return;this.form.querySelectorAll('input, select, textarea, button, [tabindex]:not([tabindex="-1"])').forEach(((e,t)=>{e instanceof HTMLElement&&!e.hasAttribute("tabindex")&&e.setAttribute("tabindex","0")}))}enhanceVisualAccessibility(){if(!this.form)return;this.form.querySelectorAll('[aria-invalid="true"], .error').forEach((e=>{e instanceof HTMLElement&&e.classList.add("accessibility-error")}))}}class E{static querySelector(e,t=document){try{return t.querySelector(e)}catch(t){return console.error(`Invalid selector: ${e}`,t),null}}static querySelectorAll(e,t=document){try{return Array.from(t.querySelectorAll(e))}catch(t){return console.error(`Invalid selector: ${e}`,t),[]}}static getValue(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked:e.value:e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement?e.value:e.textContent||""}static setValue(e,t){e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked=Boolean(t):e.value=String(t):e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement?e.value=String(t):e.textContent=String(t)}static addEventListener(e,t,i,s){return e.addEventListener(t,i,s),()=>{e.removeEventListener(t,i,s)}}static addEventListeners(e,t,i,s){const a=t.map((t=>this.addEventListener(e,t,i,s)));return()=>{a.forEach((e=>e()))}}static isVisible(e){if(!e)return!1;if("none"===getComputedStyle(e).display)return!1;if("hidden"===getComputedStyle(e).visibility)return!1;if("0"===getComputedStyle(e).opacity)return!1;const t=e.getBoundingClientRect();return 0!==t.width&&0!==t.height}static isDisabled(e){return"disabled"in e?e.disabled:"true"===e.getAttribute("aria-disabled")}static focus(e,t){e&&"function"==typeof e.focus&&e.focus(t)}static closest(e,t){try{return e.closest(t)}catch(e){return console.error(`Invalid selector: ${t}`,e),null}}static contains(e,t){return e.contains(t)}static getAttribute(e,t){return e.getAttribute(t)}static setAttribute(e,t,i){e.setAttribute(t,i)}static removeAttribute(e,t){e.removeAttribute(t)}static getDataAttribute(e,t){return e.dataset[t]}static setDataAttribute(e,t,i){e.dataset[t]=i}static addClass(e,...t){e.classList.add(...t)}static removeClass(e,...t){e.classList.remove(...t)}static hasClass(e,t){return e.classList.contains(t)}static toggleClass(e,t,i){return e.classList.toggle(t,i)}static createElement(e,t){const i=document.createElement(e);return t&&(t.id&&(i.id=t.id),t.className&&(i.className=t.className),t.attributes&&Object.entries(t.attributes).forEach((([e,t])=>{i.setAttribute(e,t)})),t.text&&(i.textContent=t.text),t.html&&(i.innerHTML=t.html)),i}static scrollIntoView(e,t){e.scrollIntoView(t??{behavior:"smooth",block:"center"})}static getFormFields(e){const t=[],i=e.elements;for(let e=0;e<i.length;e++){const s=i[e];(s instanceof HTMLInputElement||s instanceof HTMLSelectElement||s instanceof HTMLTextAreaElement)&&t.push(s)}return t}static getCheckboxGroupValue(e){return this.querySelectorAll('input[type="checkbox"]:checked',e).map((e=>e.value))}static getRadioGroupValue(e){const t=this.querySelector('input[type="radio"]:checked',e);return t?t.value:null}}class F{constructor(e=300){this.timeouts=new Map,this.defaultDelay=e}debounce(e,t,i){this.cancel(e);const s=setTimeout((()=>{t(),this.timeouts.delete(e)}),i??this.defaultDelay);this.timeouts.set(e,s)}async debounceAsync(e,t,i){return new Promise(((s,a)=>{this.debounce(e,(async()=>{try{const e=await t();s(e)}catch(e){a(e)}}),i)}))}cancel(e){const t=this.timeouts.get(e);t&&(clearTimeout(t),this.timeouts.delete(e))}cancelAll(){for(const e of this.timeouts.values())clearTimeout(e);this.timeouts.clear()}isPending(e){return this.timeouts.has(e)}getPendingCount(){return this.timeouts.size}}class A{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){const i=this.listeners.get(e);if(i){const s=i.indexOf(t);s>-1&&i.splice(s,1),0===i.length&&this.listeners.delete(e)}}emit(e,t){const i=this.listeners.get(e);i&&i.forEach((i=>{try{i(t)}catch(t){console.error(`Error in event handler for ${e}:`,t)}}))}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}hasListeners(e){const t=this.listeners.get(e);return!!t&&t.length>0}getEventNames(){return Array.from(this.listeners.keys())}}class S{constructor(e,t={}){this.fieldCleanups=new Map,this.elementToIdMap=new WeakMap,this.isInitialized=!1,this.debug=!1,this.form=e,this.options=this.mergeOptions(t),this.debug=!!t.debug,this.eventManager=new A,this.fieldStates=new n(this.eventManager),this.errorDisplay=new o(this.options.errorDisplay),this.validationEngine=new y(this.options.validation),this.accessibility=new b,this.debouncer=new F,this.log("FormManager constructor called"),this.initialize()}log(e,...t){this.debug&&console.log(`[FormManager] ${e}`,...t)}mergeOptions(e){const t={...S.DEFAULT_OPTIONS,...e,customMessages:e.customMessages||{},onFieldValidated:e.onFieldValidated,onFormValidated:e.onFormValidated,onSubmitStateChanged:e.onSubmitStateChanged};return this.log("Options merged:",t),t}initialize(){this.isInitialized?this.log("Already initialized, skipping"):(this.log("Starting initialization"),this.submitButton=this.form.querySelector('button[type="submit"]')||void 0,this.log("Submit button found:",!!this.submitButton),this.setupFormFields(),this.setupEventListeners(),this.registerCustomValidators(),this.setupCallbacks(),this.accessibility.initialize(this.form),this.isInitialized=!0,this.log("Initialization completed"),setTimeout((()=>this.updateCount()),0))}setupFormFields(){const e=this.form.querySelectorAll("input, select, textarea");this.log(`Found ${e.length} form fields`),e.forEach(((e,t)=>{if(e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement){const i=e.name||e.id;if(!i)return void this.log(`Field ${t} has no name or id, skipping`,e);this.log(`Setting up field: ${i}`,e),this.elementToIdMap.set(e,i),this.fieldStates.initializeField(i,e,void 0,(e=>this.isFieldInHiddenAreaInternal(e))),this.setupFieldValidation(e,i)}}));[{attr:"data-check_validate",type:"checkbox"},{attr:"data-radio_validate",type:"radio"},{attr:"data-select_validate",type:"select"}].forEach((({attr:e,type:t})=>{this.form.querySelectorAll(`[${e}]`).forEach(((i,s)=>{const a=i.getAttribute("name")||i.getAttribute("id")||`${t}_group_${s}`;let r;r="select"===t?i.querySelectorAll("select"):i.querySelectorAll(`input[type=${t}]`),this.setupGroupValidation(i,r,a,e)}))}))}setupFieldValidation(e,t){const i=[];if(this.log(`Setting up validation for field: ${t}`),this.options.validation.validateOnInput){this.log(`Adding input listener for field: ${t}`);const s=E.addEventListener(e,"input",(i=>{this.log(`Input event triggered for field: ${t}`,i),this.debouncer.debounce(`validate-${t}`,(()=>{this.log(`Debounced validation triggered for field: ${t}`),this.validateField(e,t)}),this.options.validation.debounceDelay)}));i.push(s)}if(this.options.validation.validateOnBlur){this.log(`Adding blur listener for field: ${t}`);const s=E.addEventListener(e,"blur",(i=>{this.log(`Blur event triggered for field: ${t}`,i),this.validateField(e,t)}));i.push(s)}if(this.options.errorDisplay.clearOnFocus){this.log(`Adding focus listener for field: ${t}`);const s=E.addEventListener(e,"focus",(e=>{this.log(`Focus event triggered for field: ${t}`,e),this.errorDisplay.clearField(t)}));i.push(s)}this.fieldCleanups.set(t,(()=>{i.forEach((e=>e()))})),this.log(`Validation setup completed for field: ${t}`)}async validateField(e,t){const s=e.value;if(this.log(`Validating field: ${t} with value:`,s),this.isFieldInHiddenAreaInternal(e))return this.log(`Skipping validation for field in hidden area: ${t}`),this.fieldStates.updateField(t,{value:s,isValid:!0,errors:[],isDirty:!0}),this.errorDisplay.clearField(t),void this.updateCount();try{const a=await this.validationEngine.validateField(e,s,this.options.customMessages,this.options.validationOptions);this.log(`Validation result for ${t}:`,a),this.fieldStates.updateField(t,{value:s,isValid:a.isValid,errors:a.errors,isDirty:!0}),this.options.errorDisplay.showOnValidation&&(a.isValid?(this.log(`Clearing error for field: ${t}`),this.errorDisplay.clearField(t)):(this.log(`Showing error for field: ${t}`,a.errors[0].message),this.errorDisplay.showFieldError(t,a.errors[0].message,e))),this.eventManager.emit(i,{fieldId:t,field:e,isValid:a.isValid,errors:a.errors.map((e=>e.message))}),this.updateCount()}catch(e){this.log(`Error during validation for field ${t}:`,e)}}updateCount(){const e=e=>{const t=document.querySelector(`[name='${e}'], [id='${e}']`);return!!t&&this.isFieldInHiddenAreaInternal(t)},t=this.fieldStates.getValidRequiredFieldCount(e),i=this.fieldStates.getTotalRequiredFieldCount(e);if(this.log(`Count updated - valid: ${t}, total: ${i}`),this.log("Required field IDs:",this.fieldStates.getRequiredFieldIds(e)),this.eventManager.emit(a,{valid:t,total:i,isComplete:t===i}),this.submitButton&&this.options.disableSubmitUntilValid){const e=t===i&&this.fieldStates.isValid;this.submitButton.disabled=!e,this.log(`Submit button disabled: ${this.submitButton.disabled}, formValid: ${e}`)}}setupEventListeners(){this.log("Setting up form event listeners");E.addEventListener(this.form,"submit",(e=>{this.log("Form submit event triggered, isValid:",this.isValid),this.isValid||(e.preventDefault(),this.log("Form submission prevented, validating all fields"),this.validateAllFieldsInternal())})),E.addEventListener(this.form,"reset",(()=>{this.log("Form reset event triggered"),this.reset()}))}async validateAllFieldsInternal(){this.log("Validating all fields (internal)");const e=this.form.querySelectorAll("input, select, textarea"),t=[];e.forEach((e=>{if(e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement){const i=this.elementToIdMap.get(e);i&&t.push(this.validateField(e,i))}})),await Promise.all(t),this.eventManager.emit(s,{form:this.form,isValid:this.isValid,fieldStates:this.fieldStates.getAllStates()}),this.log("All fields validation completed, isValid:",this.isValid)}registerCustomValidators(){this.log("Registering custom validators"),Object.entries(this.options.customMessages).forEach((([e,t])=>{e.startsWith("emesse")}))}setupCallbacks(){this.log("Setting up callbacks"),this.options.onFieldValidated&&this.eventManager.on(i,this.options.onFieldValidated),this.options.onFormValidated&&this.eventManager.on(s,this.options.onFormValidated),this.options.onCountUpdated&&this.eventManager.on(a,this.options.onCountUpdated),this.options.onSubmitStateChanged&&this.eventManager.on(r,this.options.onSubmitStateChanged)}reset(){this.log("Resetting form"),this.fieldStates.reset(),this.errorDisplay.clearAll(),this.updateCount(),this.eventManager.emit(l,{form:this.form})}destroy(){this.log("Destroying FormManager"),this.fieldCleanups.forEach((e=>e())),this.fieldCleanups.clear(),this.debouncer.cancelAll(),this.eventManager.removeAllListeners(),this.accessibility.cleanup(),this.elementToIdMap=new WeakMap,this.isInitialized=!1}on(e,t){this.eventManager.on(e,t)}off(e,t){this.eventManager.off(e,t)}getFieldState(e){return this.fieldStates.getField(e)}getFieldIdFromElement(e){return this.elementToIdMap.get(e)}get isValid(){return this.fieldStates.isValid}get isDirty(){return this.fieldStates.isDirty}getDebugInfo(){return{isInitialized:this.isInitialized,fieldCount:this.fieldCleanups.size,isValid:this.isValid,isDirty:this.isDirty,options:this.options,fieldStates:this.fieldStates.getAllStates()}}async validate(){this.log("Manual validation triggered"),await this.validateAllFieldsInternal()}async validateAllFields(){this.log("Validating all fields (comprehensive)");const e=this.form.querySelectorAll("input, select, textarea"),t=[];e.forEach((e=>{if(e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement){const i=this.elementToIdMap.get(e);if(i){const s=e.hasAttribute("required")||e.dataset.validate&&e.dataset.validate.includes("required"),a=e.value&&e.value.trim();(s||a)&&t.push(this.validateField(e,i))}}})),await Promise.all(t),this.validateAllGroupFields(),this.eventManager.emit(s,{form:this.form,isValid:this.isValid,fieldStates:this.fieldStates.getAllStates()}),this.log("All fields validation completed, isValid:",this.isValid)}updateValidationCount(){console.log("üî• DEBUG: updateValidationCount called - NEW VERSION"),this.log("=== Manual count update triggered ==="),this.log("Step 1: Reevaluating all fields required state"),this.fieldStates.reevaluateAllFieldsRequiredState((e=>{const t=document.querySelector(`[name='${e}'], [id='${e}']`),i=!!t&&this.isFieldInHiddenAreaInternal(t);return this.log(`  Field ${e}: isHidden=${i}`),i})),this.log("Step 2: Clearing hidden area errors"),this.clearHiddenAreaErrors(),this.log("Step 3: Resetting all group validation states"),this.resetAllGroupValidationStates(),this.log("Step 4: Updating count"),this.updateCount(),this.log("=== Manual count update completed ==="),console.log("üî• DEBUG: updateValidationCount completed")}isFieldInHiddenArea(e){if(e.hasAttribute("data-validate-hidden"))return!0;let t=e.parentElement;for(;t&&t!==document.body;){if(t.hasAttribute("data-validate-hidden"))return!0;t=t.parentElement}return!1}isFieldInHiddenAreaInternal(e){return this.isFieldInHiddenArea(e)}clearHiddenAreaErrors(){const e=this.fieldStates.getAllStates();for(const t in e){const e=document.querySelector(`[name='${t}'], [id='${t}']`);e&&this.isFieldInHiddenAreaInternal(e)&&(this.fieldStates.updateField(t,{isValid:!0,errors:[],isTouched:!1}),this.errorDisplay.clearField(t),this.log(`Cleared error and isTouched flag for hidden field: ${t}`))}this.form.querySelectorAll("[data-validate-hidden]").forEach((e=>{e.querySelectorAll('[data-text="error"]').forEach((e=>{e instanceof HTMLElement&&(e.textContent="",e.style.display="none")}));e.querySelectorAll("input, select, textarea").forEach((e=>{e instanceof HTMLElement&&(e.classList.remove("error","invalid"),e.setAttribute("aria-invalid","false"))}))}));this.form.querySelectorAll("[data-validate-hidden]").forEach((e=>{if(e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement){const t=e.parentElement;if(t){const e=t.querySelector('[data-text="error"]');e instanceof HTMLElement&&(e.textContent="",e.style.display="none")}e.classList.remove("error","invalid"),e.setAttribute("aria-invalid","false")}}))}validateAllGroupFields(){[{attr:"data-check_validate",type:"checkbox"},{attr:"data-radio_validate",type:"radio"},{attr:"data-select_validate",type:"select"}].forEach((({attr:e,type:t})=>{this.form.querySelectorAll(`[${e}]`).forEach(((i,s)=>{const a=i.getAttribute("name")||i.getAttribute("id")||`${t}_group_${s}`;let r;r="select"===t?i.querySelectorAll("select"):i.querySelectorAll(`input[type=${t}]`),this.validateGroupField(i,r,a,e,!0)}))}))}resetAllGroupValidationStates(){this.log("=== Resetting all group validation states ===");[{attr:"data-check_validate",type:"checkbox"},{attr:"data-radio_validate",type:"radio"},{attr:"data-select_validate",type:"select"}].forEach((({attr:e,type:t})=>{const i=this.form.querySelectorAll(`[${e}]`);this.log(`Found ${i.length} groups with ${e}`),i.forEach(((i,s)=>{const a=i.getAttribute("name")||i.getAttribute("id")||`${t}_group_${s}`;let r;r="select"===t?i.querySelectorAll("select"):i.querySelectorAll(`input[type=${t}]`);const l=this.isFieldInHiddenAreaInternal(i),n=i.getAttribute(e),o=n&&n.includes("required"),d=this.fieldStates.getField(a);this.log(`Group ${a}: isInHiddenArea=${l}, isRequired=${o}, currentState:`,d),this.fieldStates.updateField(a,{isTouched:!1,isValid:l||!o,errors:[]}),this.errorDisplay.clearField(a),this.log(`Reset group validation state for ${a}: isInHiddenArea=${l}, isRequired=${o}`),this.log(`About to call validateGroupField for ${a} with isUserAction=false`),this.validateGroupField(i,r,a,e,!1);const u=this.fieldStates.getField(a);this.log(`After validateGroupField - Group ${a} state:`,u)}))})),this.log("=== Reset all group validation states completed ===")}setupGroupValidation(e,t,i,s){e.getAttribute("name")||e.getAttribute("id")||e.setAttribute("id",i);const a=this.isFieldInHiddenAreaInternal(e),r=e.getAttribute(s),l=r&&r.includes("required");this.log(`Setting up group validation for ${i}, isInHiddenArea: ${a}, isRequired: ${l}`),this.fieldStates.initializeField(i,e,{isTouched:!1,isValid:a||!l,errors:[]},(e=>this.isFieldInHiddenAreaInternal(e))),t.forEach((a=>{a.addEventListener("change",(()=>{this.validateGroupField(e,t,i,s,!0)}))})),this.validateGroupField(e,t,i,s,!1)}validateGroupField(e,t,i,s,a=!1){if(this.log(`=== validateGroupField called for ${i} ===`),this.log(`  isUserAction: ${a}`),this.log("  groupNode:",e),this.isFieldInHiddenAreaInternal(e))return this.log(`Skipping group validation for hidden area: ${i}`),this.fieldStates.updateField(i,{isValid:!0,errors:[],isTouched:!1}),this.errorDisplay.clearField(i),void this.updateCount();const r=e.getAttribute(s);let l=!0,n="",o=!1;r&&r.includes("required")&&(o=!0),this.log(`  validateRules: ${r}`),this.log(`  isRequired: ${o}`);const d={"data-check_validate":{agree:"ÂÄã‰∫∫ÊÉÖÂ†±‰øùË≠∑ÊñπÈáù„ÅÆÂêåÊÑè„Å´„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂÖ•„Çå„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",checkbox:"„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",default:"1„Å§‰ª•‰∏äÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"},"data-radio_validate":{radiobox:"„É©„Ç∏„Ç™„Éú„Çø„É≥„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",default:"1„Å§‰ª•‰∏äÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"},"data-select_validate":{select:"ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",default:"ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}};if(o)if("data-check_validate"===s||"data-radio_validate"===s){if(l=Array.from(t).some((e=>e.checked)),!l){let e="";r&&r.includes("agree")?e=d["data-check_validate"].agree:"data-check_validate"===s?e=d["data-check_validate"].checkbox:"data-radio_validate"===s&&(e=d["data-radio_validate"].radiobox),n=e||d[s].default}}else"data-select_validate"===s&&(l=Array.from(t).some((e=>e.value)),l||(n=d["data-select_validate"].select));this.log(`  After validation check - isValid: ${l}`);const u=this.fieldStates.getField(i);let c;this.log("  Current state before isTouched update:",u),a?(c=!0,this.log(`Setting isTouched=true for user action on group ${i}`)):(c=!1,this.log(`Setting isTouched=false for programmatic validation on group ${i}`)),this.log(`  Final isTouched value: ${c}`),this.fieldStates.updateField(i,{isValid:l,errors:l||!o?[]:[{rule:"required",message:n,value:void 0}],isTouched:c});const h=this.fieldStates.getField(i);this.log("  State after update:",h);const f=o&&!l&&c;this.log(`  Error display decision: isRequired=${o}, isValid=${l}, isTouched=${c}, shouldShowError=${f}`),f?(this.errorDisplay.showFieldError(i,n,e),this.log(`Showing error for group ${i}: ${n}, isTouched: ${c}`)):(this.errorDisplay.clearField(i),this.log(`Clearing error for group ${i}, isValid: ${l}, isRequired: ${o}, isTouched: ${c}`)),this.updateCount(),this.log(`=== validateGroupField completed for ${i} ===`)}}S.DEFAULT_OPTIONS={validation:{validateOnInput:!1,validateOnBlur:!0,debounceDelay:300},errorDisplay:{showOnValidation:!0,clearOnFocus:!0},onCountUpdated:function(e){var t=document.querySelector("[data-count_validate]");t&&(t.textContent=(e.total-e.valid).toString())}};class M{static init(e,t){const i=document.querySelector("form");if(!i)throw new Error("Form element not found");const s={...e,customMessages:{...e?.customMessages,...t},disableSubmitUntilValid:e?.disableSubmitUntilValid};return this.instance&&this.instance.destroy(),this.instance=new S(i,s),this.instance}static getInstance(){return this.instance}static update(){this.instance?this.instance.updateValidationCount():console.warn("[FormValidator] Instance not found. Please initialize first.")}static async check(){this.instance?await this.instance.validateAllFields():console.warn("[FormValidator] Instance not found. Please initialize first.")}}M.instance=null,M.PostalCodeValidator=g,M.TelValidator=f,M.EmailValidator=c,M.EmailConfirmValidator=h,M.TextValidator=m,M.RequiredValidator=u,M.BaseValidator=d,M.CustomValidator=p,M.CompositeValidator=class extends d{constructor(){super(...arguments),this.validators=[]}addValidator(e){return this.validators.push(e),this}async validate(e,t){let i=this.createSuccessResult();for(const s of this.validators){const a=await s.validate(e,t);a.isValid||(i=this.combineResults(i,a))}return i.isValid?await this.handleNext(e,t):i}},M.ConditionalValidator=class extends d{constructor(e,t){super(),this.condition=e,this.validator=t}async validate(e,t){try{if(await this.condition(e,t)){const i=await this.validator.validate(e,t);if(!i.isValid)return i}return await this.handleNext(e,t)}catch(t){const i=`Êù°‰ª∂„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É©„Éº: ${t}`;return this.createFailureResult([this.createError("conditional-error",i,e)])}}},"undefined"!=typeof window&&(window.FormValidator=M,window.FormManager=S);return t=t.FormValidator})()));