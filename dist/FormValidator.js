!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FormValidator=t():e.FormValidator=t()}(this,(()=>(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{FormValidator:()=>p});const s="field:validated",i="form:validated",a="count:updated",r="submit:state-changed",n="form:reset";class l{constructor(e){this.fields=new Map,this.eventManager=e}initializeField(e,t){const s={value:t.value||"",isValid:!0,errors:[],isDirty:!1,isTouched:!1};this.fields.set(e,s)}updateField(e,t){const s=this.fields.get(e);if(s){const i={...s,...t};this.fields.set(e,i)}}getField(e){return this.fields.get(e)}getAllStates(){const e={};for(const[t,s]of this.fields)e[t]={...s};return e}getValidFieldCount(){let e=0;for(const t of this.fields.values())t.isValid&&e++;return e}getTotalFieldCount(){return this.fields.size}get isValid(){for(const e of this.fields.values())if(!e.isValid)return!1;return!0}get isDirty(){for(const e of this.fields.values())if(e.isDirty)return!0;return!1}reset(){for(const[e,t]of this.fields)this.fields.set(e,{...t,value:"",isValid:!0,errors:[],isDirty:!1,isTouched:!1})}removeField(e){this.fields.delete(e)}clear(){this.fields.clear()}}class o{constructor(e){this.errorElements=new Map,this.options=e}showFieldError(e,t,s){if(!this.options.showOnValidation)return;this.clearField(e);const i=this.createErrorElement(t);i.id=`${e}-error`,i.setAttribute("role","alert"),i.setAttribute("aria-live","polite");const a=s.parentElement;a&&a.insertBefore(i,s.nextSibling);const r=s.getAttribute("aria-describedby");r?s.setAttribute("aria-describedby",`${r} ${i.id}`):s.setAttribute("aria-describedby",i.id),this.errorElements.set(e,i),this.animateShow(i),s.classList.add("error","invalid"),s.setAttribute("aria-invalid","true")}clearField(e){const t=this.errorElements.get(e);if(t){this.animateHide(t,(()=>{t.parentElement&&t.parentElement.removeChild(t)}));const s=document.querySelector(`[name="${e}"], [id="${e}"]`);if(s){const t=s.getAttribute("aria-describedby");if(t){const i=t.split(" ").filter((t=>t!==`${e}-error`)).join(" ");i?s.setAttribute("aria-describedby",i):s.removeAttribute("aria-describedby")}s.classList.remove("error","invalid"),s.setAttribute("aria-invalid","false")}this.errorElements.delete(e)}}clearAll(){for(const e of this.errorElements.keys())this.clearField(e)}createErrorElement(e){const t=document.createElement("div");return t.className="error-message",t.textContent=e,t.style.cssText="\n            color: #dc3545;\n            font-size: 0.875rem;\n            margin-top: 0.25rem;\n            display: block;\n        ",t}animateShow(e){this.options.animationDuration>0&&(e.style.opacity="0",e.style.transform="translateY(-10px)",e.style.transition=`opacity ${this.options.animationDuration}ms ease, transform ${this.options.animationDuration}ms ease`,requestAnimationFrame((()=>{e.style.opacity="1",e.style.transform="translateY(0)"})))}animateHide(e,t){this.options.animationDuration>0?(e.style.transition=`opacity ${this.options.animationDuration}ms ease, transform ${this.options.animationDuration}ms ease`,e.style.opacity="0",e.style.transform="translateY(-10px)",setTimeout(t,this.options.animationDuration)):t()}hasError(e){return this.errorElements.has(e)}getErrorCount(){return this.errorElements.size}}class u{constructor(e){this.options=e}async validateField(e,t,s={}){const i=[];return e.hasAttribute("required")&&!t.trim()&&i.push({rule:"required",message:s.required||"この項目は必須です",value:t}),e instanceof HTMLInputElement&&await this.validateInputField(e,t,i,s),e instanceof HTMLSelectElement&&this.validateSelectField(e,t,i,s),e instanceof HTMLTextAreaElement&&this.validateTextareaField(e,t,i,s),{isValid:0===i.length,errors:i}}async validateInputField(e,t,s,i){const a=e.type;switch(a){case"email":t&&!this.isValidEmail(t)&&s.push({rule:"email",message:i.email||"有効なメールアドレスを入力してください",value:t});break;case"url":t&&!this.isValidUrl(t)&&s.push({rule:"url",message:i.url||"有効なURLを入力してください",value:t});break;case"tel":t&&!this.isValidPhone(t)&&s.push({rule:"tel",message:i.tel||"有効な電話番号を入力してください",value:t});break;case"number":t&&!this.isValidNumber(t)&&s.push({rule:"number",message:i.number||"有効な数値を入力してください",value:t})}if(e.minLength>0&&t.length<e.minLength&&s.push({rule:"minlength",message:i.minlength||`${e.minLength}文字以上で入力してください`,value:t}),e.maxLength>0&&t.length>e.maxLength&&s.push({rule:"maxlength",message:i.maxlength||`${e.maxLength}文字以下で入力してください`,value:t}),"number"===a&&t){const a=parseFloat(t);isNaN(a)||(e.min&&a<parseFloat(e.min)&&s.push({rule:"min",message:i.min||`${e.min}以上の値を入力してください`,value:t}),e.max&&a>parseFloat(e.max)&&s.push({rule:"max",message:i.max||`${e.max}以下の値を入力してください`,value:t}))}if(e.pattern&&t){new RegExp(e.pattern).test(t)||s.push({rule:"pattern",message:i.pattern||"入力形式が正しくありません",value:t})}}validateSelectField(e,t,s,i){}validateTextareaField(e,t,s,i){e.minLength>0&&t.length<e.minLength&&s.push({rule:"minlength",message:i.minlength||`${e.minLength}文字以上で入力してください`,value:t}),e.maxLength>0&&t.length>e.maxLength&&s.push({rule:"maxlength",message:i.maxlength||`${e.maxLength}文字以下で入力してください`,value:t})}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidUrl(e){try{return new URL(e),!0}catch{return!1}}isValidPhone(e){return/^[\d\-\(\)\+\s]+$/.test(e)&&e.replace(/\D/g,"").length>=10}isValidNumber(e){return!isNaN(parseFloat(e))&&isFinite(parseFloat(e))}}class d{initialize(e){this.form=e,this.setupAriaLiveRegion(),this.enhanceFormAccessibility()}setupAriaLiveRegion(){if(!this.form)return;let e=this.form.querySelector("[aria-live]");e||(e=document.createElement("div"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",e.style.cssText="\n                position: absolute;\n                width: 1px;\n                height: 1px;\n                padding: 0;\n                margin: -1px;\n                overflow: hidden;\n                clip: rect(0, 0, 0, 0);\n                white-space: nowrap;\n                border: 0;\n            ",this.form.appendChild(e)),this.ariaLiveRegion=e}enhanceFormAccessibility(){if(!this.form)return;this.form.hasAttribute("role")||this.form.setAttribute("role","form");this.form.querySelectorAll("[required]").forEach((e=>{e.hasAttribute("aria-required")||e.setAttribute("aria-required","true")})),this.enhanceLabeling(),this.enhanceFieldsets()}enhanceLabeling(){if(!this.form)return;this.form.querySelectorAll("input, select, textarea").forEach((e=>{if(e instanceof HTMLElement){const t=e.id,s=e.name;!t&&s&&(e.id=`field-${s}`);let i=this.form.querySelector(`label[for="${e.id}"]`);if(!i&&s&&(i=this.form.querySelector(`label[for="${s}"]`),i&&i.setAttribute("for",e.id)),!i){const t=e.closest("label");t&&(i=t)}i&&!e.hasAttribute("aria-labelledby")&&(i.id||(i.id=`label-${e.id}`),e.setAttribute("aria-labelledby",i.id))}}))}enhanceFieldsets(){if(!this.form)return;this.form.querySelectorAll("fieldset").forEach((e=>{const t=e.querySelector("legend");t&&!e.hasAttribute("aria-labelledby")&&(t.id||(t.id=`legend-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),e.setAttribute("aria-labelledby",t.id))}))}announceStatus(e){this.ariaLiveRegion&&(this.ariaLiveRegion.textContent=e,setTimeout((()=>{this.ariaLiveRegion&&(this.ariaLiveRegion.textContent="")}),1e3))}announceError(e){this.announceStatus(`エラー: ${e}`)}announceSuccess(e){this.announceStatus(`成功: ${e}`)}focusField(e){if(!this.form)return;const t=this.form.querySelector(`#${e}, [name="${e}"]`);t&&"function"==typeof t.focus&&t.focus()}focusFirstError(){if(!this.form)return;const e=this.form.querySelector('[aria-invalid="true"], .error');e&&"function"==typeof e.focus&&e.focus()}cleanup(){this.ariaLiveRegion&&this.ariaLiveRegion.parentElement&&this.ariaLiveRegion.parentElement.removeChild(this.ariaLiveRegion),this.ariaLiveRegion=void 0,this.form=void 0}enhanceKeyboardNavigation(){if(!this.form)return;this.form.querySelectorAll('input, select, textarea, button, [tabindex]:not([tabindex="-1"])').forEach(((e,t)=>{e instanceof HTMLElement&&!e.hasAttribute("tabindex")&&e.setAttribute("tabindex","0")}))}enhanceVisualAccessibility(){if(!this.form)return;this.form.querySelectorAll('[aria-invalid="true"], .error').forEach((e=>{e instanceof HTMLElement&&e.classList.add("accessibility-error")}))}}class h{static querySelector(e,t=document){try{return t.querySelector(e)}catch(t){return console.error(`Invalid selector: ${e}`,t),null}}static querySelectorAll(e,t=document){try{return Array.from(t.querySelectorAll(e))}catch(t){return console.error(`Invalid selector: ${e}`,t),[]}}static getValue(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked:e.value:e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement?e.value:e.textContent||""}static setValue(e,t){e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked=Boolean(t):e.value=String(t):e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement?e.value=String(t):e.textContent=String(t)}static addEventListener(e,t,s,i){return e.addEventListener(t,s,i),()=>{e.removeEventListener(t,s,i)}}static addEventListeners(e,t,s,i){const a=t.map((t=>this.addEventListener(e,t,s,i)));return()=>{a.forEach((e=>e()))}}static isVisible(e){if(!e)return!1;if("none"===getComputedStyle(e).display)return!1;if("hidden"===getComputedStyle(e).visibility)return!1;if("0"===getComputedStyle(e).opacity)return!1;const t=e.getBoundingClientRect();return 0!==t.width&&0!==t.height}static isDisabled(e){return"disabled"in e?e.disabled:"true"===e.getAttribute("aria-disabled")}static focus(e,t){e&&"function"==typeof e.focus&&e.focus(t)}static closest(e,t){try{return e.closest(t)}catch(e){return console.error(`Invalid selector: ${t}`,e),null}}static contains(e,t){return e.contains(t)}static getAttribute(e,t){return e.getAttribute(t)}static setAttribute(e,t,s){e.setAttribute(t,s)}static removeAttribute(e,t){e.removeAttribute(t)}static getDataAttribute(e,t){return e.dataset[t]}static setDataAttribute(e,t,s){e.dataset[t]=s}static addClass(e,...t){e.classList.add(...t)}static removeClass(e,...t){e.classList.remove(...t)}static hasClass(e,t){return e.classList.contains(t)}static toggleClass(e,t,s){return e.classList.toggle(t,s)}static createElement(e,t){const s=document.createElement(e);return t&&(t.id&&(s.id=t.id),t.className&&(s.className=t.className),t.attributes&&Object.entries(t.attributes).forEach((([e,t])=>{s.setAttribute(e,t)})),t.text&&(s.textContent=t.text),t.html&&(s.innerHTML=t.html)),s}static scrollIntoView(e,t){e.scrollIntoView(t??{behavior:"smooth",block:"center"})}static getFormFields(e){const t=[],s=e.elements;for(let e=0;e<s.length;e++){const i=s[e];(i instanceof HTMLInputElement||i instanceof HTMLSelectElement||i instanceof HTMLTextAreaElement)&&t.push(i)}return t}static getCheckboxGroupValue(e){return this.querySelectorAll('input[type="checkbox"]:checked',e).map((e=>e.value))}static getRadioGroupValue(e){const t=this.querySelector('input[type="radio"]:checked',e);return t?t.value:null}}class c{constructor(e=300){this.timeouts=new Map,this.defaultDelay=e}debounce(e,t,s){this.cancel(e);const i=setTimeout((()=>{t(),this.timeouts.delete(e)}),s??this.defaultDelay);this.timeouts.set(e,i)}async debounceAsync(e,t,s){return new Promise(((i,a)=>{this.debounce(e,(async()=>{try{const e=await t();i(e)}catch(e){a(e)}}),s)}))}cancel(e){const t=this.timeouts.get(e);t&&(clearTimeout(t),this.timeouts.delete(e))}cancelAll(){for(const e of this.timeouts.values())clearTimeout(e);this.timeouts.clear()}isPending(e){return this.timeouts.has(e)}getPendingCount(){return this.timeouts.size}}class f{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){const s=this.listeners.get(e);if(s){const i=s.indexOf(t);i>-1&&s.splice(i,1),0===s.length&&this.listeners.delete(e)}}emit(e,t){const s=this.listeners.get(e);s&&s.forEach((s=>{try{s(t)}catch(t){console.error(`Error in event handler for ${e}:`,t)}}))}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}hasListeners(e){const t=this.listeners.get(e);return!!t&&t.length>0}getEventNames(){return Array.from(this.listeners.keys())}}class m{constructor(e,t={}){this.fieldCleanups=new Map,this.elementToIdMap=new WeakMap,this.isInitialized=!1,this.debug=!1,this.form=e,this.options=this.mergeOptions(t),this.debug=!!t.debug,this.eventManager=new f,this.fieldStates=new l(this.eventManager),this.errorDisplay=new o(this.options.errorDisplay),this.validationEngine=new u(this.options.validation),this.accessibility=new d,this.debouncer=new c,this.log("FormManager constructor called"),this.initialize()}log(e,...t){this.debug&&console.log(`[FormManager] ${e}`,...t)}mergeOptions(e){const t={validation:{validateOnInput:!0,validateOnBlur:!0,debounceDelay:300,...e.validation},errorDisplay:{showOnValidation:!0,clearOnFocus:!0,animationDuration:200,...e.errorDisplay},customMessages:e.customMessages||{},onFieldValidated:e.onFieldValidated,onFormValidated:e.onFormValidated,onCountUpdated:e.onCountUpdated,onSubmitStateChanged:e.onSubmitStateChanged};return this.log("Options merged:",t),t}initialize(){this.isInitialized?this.log("Already initialized, skipping"):(this.log("Starting initialization"),this.submitButton=this.form.querySelector('button[type="submit"]')||void 0,this.log("Submit button found:",!!this.submitButton),this.setupFormFields(),this.setupEventListeners(),this.registerCustomValidators(),this.setupCallbacks(),this.accessibility.initialize(this.form),this.isInitialized=!0,this.log("Initialization completed"))}setupFormFields(){const e=this.form.querySelectorAll("input, select, textarea");this.log(`Found ${e.length} form fields`),e.forEach(((e,t)=>{if(e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement){const s=e.name||e.id;if(!s)return void this.log(`Field ${t} has no name or id, skipping`,e);this.log(`Setting up field: ${s}`,e),this.elementToIdMap.set(e,s),this.fieldStates.initializeField(s,e),this.setupFieldValidation(e,s)}}))}setupFieldValidation(e,t){const s=[];if(this.log(`Setting up validation for field: ${t}`),this.options.validation.validateOnInput){this.log(`Adding input listener for field: ${t}`);const i=h.addEventListener(e,"input",(s=>{this.log(`Input event triggered for field: ${t}`,s),this.debouncer.debounce(`validate-${t}`,(()=>{this.log(`Debounced validation triggered for field: ${t}`),this.validateField(e,t)}),this.options.validation.debounceDelay)}));s.push(i)}if(this.options.validation.validateOnBlur){this.log(`Adding blur listener for field: ${t}`);const i=h.addEventListener(e,"blur",(s=>{this.log(`Blur event triggered for field: ${t}`,s),this.validateField(e,t)}));s.push(i)}if(this.options.errorDisplay.clearOnFocus){this.log(`Adding focus listener for field: ${t}`);const i=h.addEventListener(e,"focus",(e=>{this.log(`Focus event triggered for field: ${t}`,e),this.errorDisplay.clearField(t)}));s.push(i)}this.fieldCleanups.set(t,(()=>{s.forEach((e=>e()))})),this.log(`Validation setup completed for field: ${t}`)}async validateField(e,t){const i=e.value;this.log(`Validating field: ${t} with value:`,i);try{const a=await this.validationEngine.validateField(e,i,this.options.customMessages);this.log(`Validation result for ${t}:`,a),this.fieldStates.updateField(t,{value:i,isValid:a.isValid,errors:a.errors,isDirty:!0}),this.options.errorDisplay.showOnValidation&&(a.isValid?(this.log(`Clearing error for field: ${t}`),this.errorDisplay.clearField(t)):(this.log(`Showing error for field: ${t}`,a.errors[0].message),this.errorDisplay.showFieldError(t,a.errors[0].message,e))),this.eventManager.emit(s,{fieldId:t,field:e,isValid:a.isValid,errors:a.errors.map((e=>e.message))}),this.updateCount()}catch(e){this.log(`Error during validation for field ${t}:`,e)}}updateCount(){const e=this.fieldStates.getValidFieldCount(),t=this.fieldStates.getTotalFieldCount();this.log(`Count updated - valid: ${e}, total: ${t}`),this.eventManager.emit(a,{valid:e,total:t,isComplete:e===t})}setupEventListeners(){this.log("Setting up form event listeners"),h.addEventListener(this.form,"submit",(e=>{this.log("Form submit event triggered, isValid:",this.isValid),this.isValid||(e.preventDefault(),this.log("Form submission prevented, validating all fields"),this.validateAllFields())})),h.addEventListener(this.form,"reset",(()=>{this.log("Form reset event triggered"),this.reset()}))}async validateAllFields(){this.log("Validating all fields");const e=this.form.querySelectorAll("input, select, textarea"),t=[];e.forEach((e=>{if(e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement){const s=this.elementToIdMap.get(e);s&&t.push(this.validateField(e,s))}})),await Promise.all(t),this.eventManager.emit(i,{form:this.form,isValid:this.isValid,fieldStates:this.fieldStates.getAllStates()}),this.log("All fields validation completed, isValid:",this.isValid)}registerCustomValidators(){this.log("Registering custom validators"),Object.entries(this.options.customMessages).forEach((([e,t])=>{e.startsWith("emesse")}))}setupCallbacks(){this.log("Setting up callbacks"),this.options.onFieldValidated&&this.eventManager.on(s,this.options.onFieldValidated),this.options.onFormValidated&&this.eventManager.on(i,this.options.onFormValidated),this.options.onCountUpdated&&this.eventManager.on(a,this.options.onCountUpdated),this.options.onSubmitStateChanged&&this.eventManager.on(r,this.options.onSubmitStateChanged)}reset(){this.log("Resetting form"),this.fieldStates.reset(),this.errorDisplay.clearAll(),this.updateCount(),this.submitButton&&(this.submitButton.disabled=!1),this.eventManager.emit(n,{form:this.form})}destroy(){this.log("Destroying FormManager"),this.fieldCleanups.forEach((e=>e())),this.fieldCleanups.clear(),this.debouncer.cancelAll(),this.eventManager.removeAllListeners(),this.accessibility.cleanup(),this.elementToIdMap=new WeakMap,this.isInitialized=!1}on(e,t){this.eventManager.on(e,t)}off(e,t){this.eventManager.off(e,t)}getFieldState(e){return this.fieldStates.getField(e)}getFieldIdFromElement(e){return this.elementToIdMap.get(e)}get isValid(){return this.fieldStates.isValid}get isDirty(){return this.fieldStates.isDirty}getDebugInfo(){return{isInitialized:this.isInitialized,fieldCount:this.fieldCleanups.size,isValid:this.isValid,isDirty:this.isDirty,options:this.options,fieldStates:this.fieldStates.getAllStates()}}async validate(){this.log("Manual validation triggered"),await this.validateAllFields()}}class g{constructor(){this.next=null}setNext(e){return this.next=e,e}async handleNext(e,t){if(this.next){return await this.next.validate(e,t)}return{isValid:!0,errors:[]}}combineResults(e,t){return{isValid:e.isValid&&t.isValid,errors:[...e.errors,...t.errors]}}isEmpty(e){return null===e||(void 0===e||("string"==typeof e?""===e.trim():Array.isArray(e)?0===e.length:"object"==typeof e&&0===Object.keys(e).length))}convertToString(e,t,s,i){if("string"==typeof e)return{success:!0,value:e};if("number"==typeof e)return{success:!0,value:String(e)};{const a=this.createErrorMessage(t,s,i);return{success:!1,result:this.createFailureResult([this.createError(t,a,e)])}}}createErrorMessage(e,t,s){return s?.message?s.message:t}createError(e,t,s){return{rule:e,message:t,value:s}}createSuccessResult(){return{isValid:!0,errors:[]}}createFailureResult(e){return{isValid:!1,errors:e}}}class p{static init(e,t){const s=document.querySelector("form");if(!s)throw new Error("Form element not found");const i={...e,customMessages:{...e?.customMessages,...t}};return this.instance&&this.instance.destroy(),this.instance=new m(s,i),this.instance}static getInstance(){return this.instance}}p.instance=null,p.PostalCodeValidator=class extends g{constructor(){super(...arguments),this.patterns={postalCodeWithHyphens:/^\d{3}-\d{4}$/,postalCodeWithoutHyphens:/^\d{7}$/,halfWidth:/^[0-9\-]+$/},this.defaultMessages={default:"郵便番号の形式が正しくありません。",withHyphens:"郵便番号はハイフン付きの形式で入力してください。",withoutHyphens:"郵便番号はハイフンなしの形式で入力してください。",halfWidth:"半角数字で入力してください。"}}async validate(e,t){if(console.log("postal-code validate",e,t),this.isEmpty(e))return await this.handleNext(e,t);const s=this.convertToString(e,"postal-code",this.defaultMessages.default,t);if(!s.success)return s.result;const i=s.value,a=this.normalizeNumber(i);if(!this.patterns.halfWidth.test(a)){const s=this.createErrorMessage("postal-code-halfwidth",this.defaultMessages.halfWidth,t);return this.createFailureResult([this.createError("postal-code-halfwidth",s,e)])}const r=t?.allowHyphens??null;let n=!1,l=this.defaultMessages.default;if(!0===r?(n=this.patterns.postalCodeWithHyphens.test(a),l=this.defaultMessages.withHyphens):!1===r?(n=this.patterns.postalCodeWithoutHyphens.test(a),l=this.defaultMessages.withoutHyphens):n=this.patterns.postalCodeWithHyphens.test(a)||this.patterns.postalCodeWithoutHyphens.test(a),!n){const s=this.createErrorMessage("postal-code",l,t);return this.createFailureResult([this.createError("postal-code",s,e)])}return t?.usePostalCodeJS&&t?.onValidPostalCode&&t.onValidPostalCode(a),await this.handleNext(a,t)}normalizeNumber(e){return e.replace(/[０-９]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/[ー－]/g,"-")}},p.TelValidator=class extends g{constructor(){super(...arguments),this.patterns={telWithHyphens:/^0(((\d{1}-\d{4}|\d{2}-\d{3,4}|\d{3}-\d{2,3}|\d{4}-\d{1})-\d{4})|\d{3}-\d{3}-\d{3})$/,telWithoutHyphens:/^0\d{9,10}$/,halfWidth:/^[0-9\-]+$/},this.defaultMessages={default:"電話番号の形式が正しくありません。",withHyphens:"電話番号はハイフン付きの形式で入力してください。",withoutHyphens:"電話番号はハイフンなしの形式で入力してください。",halfWidth:"半角数字で入力してください。"}}async validate(e,t){if(this.isEmpty(e))return await this.handleNext(e,t);const s=this.convertToString(e,"tel",this.defaultMessages.default,t);if(!s.success)return s.result;const i=s.value,a=this.normalizeNumber(i);if(!this.patterns.halfWidth.test(a)){const s=this.createErrorMessage("tel-halfwidth",this.defaultMessages.halfWidth,t);return this.createFailureResult([this.createError("tel-halfwidth",s,e)])}const r=t?.allowHyphens??null;let n=!1,l=this.defaultMessages.default;if(!0===r?(n=this.patterns.telWithHyphens.test(a),l=this.defaultMessages.withHyphens):!1===r?(n=this.patterns.telWithoutHyphens.test(a),l=this.defaultMessages.withoutHyphens):n=this.patterns.telWithHyphens.test(a)||this.patterns.telWithoutHyphens.test(a),!n){const s=this.createErrorMessage("tel",l,t);return this.createFailureResult([this.createError("tel",s,e)])}return await this.handleNext(a,t)}normalizeNumber(e){return e.replace(/[０-９]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/[ー－]/g,"-")}},p.EmailValidator=class extends g{constructor(){super(...arguments),this.emailPattern=/^([a-zA-Z0-9])+([a-zA-Z0-9\._-])*@([a-zA-Z0-9_-])+([a-zA-Z0-9\._-]+)+$/,this.defaultMessage="メールアドレスの形式が正しくありません。"}async validate(e,t){if(this.isEmpty(e))return await this.handleNext(e,t);const s=this.convertToString(e,"email",this.defaultMessage,t);if(!s.success)return s.result;const i=s.value;if(!this.emailPattern.test(i)){const s=this.createErrorMessage("email",this.defaultMessage,t);return this.createFailureResult([this.createError("email",s,e)])}if(t?.checkConfirmation){const s=t.confirmationValue;if(s&&i!==s){const s=t.mismatchMessage||"メールアドレスが一致しません。";return this.createFailureResult([this.createError("email-mismatch",s,e)])}}return await this.handleNext(i,t)}},p.EmailConfirmValidator=class extends g{constructor(){super(...arguments),this.defaultMessage="メールアドレスが一致しません。"}async validate(e,t){if(this.isEmpty(e))return await this.handleNext(e,t);const s=this.convertToString(e,"email-conf",this.defaultMessage,t);if(!s.success)return s.result;const i=s.value,a=t?.originalEmail;if(a){if(i!==a){const s=this.createErrorMessage("email-conf",this.defaultMessage,t);return this.createFailureResult([this.createError("email-conf",s,e)])}}else{const s=document.querySelector('input[data-validate*="email"]:not([data-validate*="email-conf"])');if(s){if(i!==s.value){const s=this.createErrorMessage("email-conf",this.defaultMessage,t);return this.createFailureResult([this.createError("email-conf",s,e)])}}}return await this.handleNext(i,t)}},p.TextValidator=class extends g{constructor(){super(...arguments),this.patterns={number:/^\d+$/,hiragana:/^[ぁ-んー　 ]+$/,katakana:/^[ァ-ヶー　 ]+$/,halfWidth:/^[0-9\-]+$/,password:/^(?=.*?[a-z])(?=.*?\d)[a-z\d]{8,16}$/i},this.defaultMessages={number:"半角数字で入力してください。",hiragana:"全角ひらがなで入力してください。",katakana:"全角カタカナで入力してください。",halfWidth:"半角数字で入力してください。",password:"半角英数字をそれぞれ含む8文字以上16文字以下で入力してください。"}}async validate(e,t){if(this.isEmpty(e))return await this.handleNext(e,t);const s=this.convertToString(e,"text","文字列を入力してください。",t);if(!s.success)return s.result;const i=s.value,a=t?.textType||t?.validationType;if(!a)return await this.handleNext(i,t);switch(a){case"number":if(!1!==t?.checkHalfWidth){const s=this.normalizeNumber(i);if(!this.patterns.halfWidth.test(s)){const s=this.createErrorMessage("halfwidth",this.defaultMessages.halfWidth,t);return this.createFailureResult([this.createError("halfwidth",s,e)])}if(!this.patterns.number.test(s)){const s=this.createErrorMessage("number",this.defaultMessages.number,t);return this.createFailureResult([this.createError("number",s,e)])}}else if(!this.patterns.number.test(i)){const s=this.createErrorMessage("number",this.defaultMessages.number,t);return this.createFailureResult([this.createError("number",s,e)])}break;case"hiragana":if(!this.patterns.hiragana.test(i)){const s=this.createErrorMessage("hiragana",this.defaultMessages.hiragana,t);return this.createFailureResult([this.createError("hiragana",s,e)])}break;case"katakana":if(!this.patterns.katakana.test(i)){const s=this.createErrorMessage("katakana",this.defaultMessages.katakana,t);return this.createFailureResult([this.createError("katakana",s,e)])}break;case"password":if(!this.patterns.password.test(i)){const s=this.createErrorMessage("password",this.defaultMessages.password,t);return this.createFailureResult([this.createError("password",s,e)])}}return await this.handleNext(i,t)}normalizeNumber(e){return e.replace(/[０-９]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/[ー－]/g,"-")}},p.RequiredValidator=class extends g{constructor(){super(...arguments),this.defaultMessages={default:"この項目は入力必須です。",name:"お名前を入力してください。",furiganaHira:"ふりがなを入力してください。",furiganaKana:"フリガナを入力してください。",postalCode:"郵便番号を入力してください。",postal:"住所を入力してください。",tel:"電話番号を入力してください。",email:"メールアドレスを入力してください。",emailConf:"確認用メールアドレスを入力してください。",password:"パスワードを入力してください。",text:"お問い合わせ内容を入力してください。",checkbox:"チェックボックスを選択してください。",radiobox:"ラジオボタンを選択してください。",agree:"個人情報保護方針の同意にチェックを入れてください。",select:"選択してください。"}}async validate(e,t){if(console.log("required validate",e,t),this.isEmpty(e)){const s=this.determineErrorMessage(t);return this.createFailureResult([this.createError("required",s,e)])}return await this.handleNext(e,t)}determineErrorMessage(e){if(e?.message)return e.message;if(e?.customMessageKey&&e?.customMessages?.[e.customMessageKey])return e.customMessages[e.customMessageKey];if(e?.fieldType){const t=e.fieldType;if(t in this.defaultMessages)return this.defaultMessages[t]}if(e?.validationTypes){const t=e.validationTypes;if(t.includes("name"))return this.defaultMessages.name;if(t.includes("furigana")){if(t.includes("hiragana"))return this.defaultMessages.furiganaHira;if(t.includes("katakana"))return this.defaultMessages.furiganaKana}if(t.includes("postal-code"))return this.defaultMessages.postalCode;if(t.includes("postal"))return this.defaultMessages.postal;if(t.includes("tel"))return this.defaultMessages.tel;if(t.includes("email-conf"))return this.defaultMessages.emailConf;if(t.includes("email"))return this.defaultMessages.email;if(t.includes("password"))return this.defaultMessages.password;if(t.includes("text"))return this.defaultMessages.text;if(t.includes("agree"))return this.defaultMessages.agree}return"checkbox"===e?.elementType?this.defaultMessages.checkbox:"radio"===e?.elementType?this.defaultMessages.radiobox:"select"===e?.elementType?this.defaultMessages.select:this.defaultMessages.default}},p.BaseValidator=g,p.CustomValidator=class extends g{constructor(e,t="カスタムバリデーションエラー"){super(),this.customValidationFunction=e,this.customErrorMessage=t}async validate(e,t){try{if(!await this.customValidationFunction(e,t)){const s=this.createErrorMessage("custom",this.customErrorMessage,t);return this.createFailureResult([this.createError("custom",s,e)])}return await this.handleNext(e,t)}catch(s){const i=t?.message||`バリデーションエラー: ${s}`;return this.createFailureResult([this.createError("custom-error",i,e)])}}},p.CompositeValidator=class extends g{constructor(){super(...arguments),this.validators=[]}addValidator(e){return this.validators.push(e),this}async validate(e,t){let s=this.createSuccessResult();for(const i of this.validators){const a=await i.validate(e,t);a.isValid||(s=this.combineResults(s,a))}return s.isValid?await this.handleNext(e,t):s}},p.ConditionalValidator=class extends g{constructor(e,t){super(),this.condition=e,this.validator=t}async validate(e,t){try{if(await this.condition(e,t)){const s=await this.validator.validate(e,t);if(!s.isValid)return s}return await this.handleNext(e,t)}catch(t){const s=`条件チェックエラー: ${t}`;return this.createFailureResult([this.createError("conditional-error",s,e)])}}},"undefined"!=typeof window&&(window.FormValidator=p,window.FormManager=m);return t=t.FormValidator})()));